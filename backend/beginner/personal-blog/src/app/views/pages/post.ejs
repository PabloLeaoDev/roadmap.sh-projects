<div class="reading-progress" id="reading-progress"></div>

<header class="header">
    <div class="header-content">
        <a href="/home" class="logo">
            ğŸ“š MeuBlog
        </a>
        <nav class="nav-links">
            <a href="/home">â† Voltar ao Blog</a>
            <% if (user) { %>
                <a href="/admin" class="admin-btn">ğŸ”§ Admin</a>
                <% if (article) { %>
                    <a href="/admin/edit/<%= article.id %>" class="admin-btn">âœï¸ Editar</a>
                <% } %>
                <a href="/logout">Sair</a>
            <% } else { %>
                <a href="/login" class="admin-btn">Login</a>
            <% } %>
        </nav>
    </div>
</header>

<div class="breadcrumb">
    <div class="breadcrumb-content">
        <a href="/home">Blog</a>
        <span>â†’</span>
        <% if (article && article.category) { %>
            <a href="/home?category=<%= article.category %>"><%= article.category %></a>
            <span>â†’</span>
        <% } %>
        <span><%= article ? article.title : 'Artigo nÃ£o encontrado' %></span>
    </div>
</div>

<div class="article-container">
    <% if (article) { %>
        <!-- Article Header -->
        <article class="article-header">
            <% if (article.category) { %>
                <div class="article-category-badge">
                    <% if (article.category === 'Tecnologia') { %>
                        ğŸ’» <%= article.category %>
                    <% } else if (article.category === 'EducaÃ§Ã£o') { %>
                        ğŸ“š <%= article.category %>
                    <% } else if (article.category === 'SaÃºde') { %>
                        ğŸ¥ <%= article.category %>
                    <% } else if (article.category === 'NegÃ³cios') { %>
                        ğŸ’¼ <%= article.category %>
                    <% } else if (article.category === 'Lifestyle') { %>
                        ğŸŒŸ <%= article.category %>
                    <% } else { %>
                        ğŸ“„ <%= article.category %>
                    <% } %>
                </div>
            <% } %>

            <h1 class="article-title"><%= article.title %></h1>

            <% if (article.summary) { %>
                <p class="article-summary"><%= article.summary %></p>
            <% } %>

            <div class="article-meta">
                <div class="meta-item">
                    <span>ğŸ“</span>
                    <span>Por <strong class="author-name"><%= article.author %></strong></span>
                </div>
                <div class="meta-item">
                    <span>ğŸ“…</span>
                    <span><%= new Date(article.createdAt).toLocaleDateString('pt-BR', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    }) %></span>
                </div>
                <% if (article.updatedAt && new Date(article.updatedAt) > new Date(article.createdAt)) { %>
                    <div class="meta-item">
                        <span>ğŸ”„</span>
                        <span>Atualizado em <%= new Date(article.updatedAt).toLocaleDateString('pt-BR') %></span>
                    </div>
                <% } %>
            </div>

            <div class="article-stats">
                <div class="stat-item">
                    <span>â±ï¸</span>
                    <span><%= Math.ceil(article.content.split(' ').length / 200) %> min de leitura</span>
                </div>
                <div class="stat-item">
                    <span>ğŸ“</span>
                    <span><%= article.content.split(' ').length %> palavras</span>
                </div>
                <div class="stat-item">
                    <span>ğŸ‘ï¸</span>
                    <span><%= article.views || 0 %> visualizaÃ§Ãµes</span>
                </div>
            </div>
        </article>

        <!-- Article Content -->
        <div class="article-content">
            <%- article.content.replace(/\n/g, '<br>') %>
        </div>

        <!-- Article Tags -->
        <% if (article.tags) { %>
            <div class="article-tags">
                <h4>ğŸ·ï¸ Tags relacionadas</h4>
                <div class="tags-container">
                    <% article.tags.split(',').forEach(function(tag) { %>
                        <% if (tag.trim()) { %>
                            <a href="/home?search=<%= tag.trim() %>" class="tag">
                                #<%= tag.trim() %>
                            </a>
                        <% } %>
                    <% }); %>
                </div>
            </div>
        <% } %>

        <!-- Share Buttons -->
        <div class="share-buttons">
            <h4>ğŸ“¤ Compartilhe este artigo</h4>
            <div class="social-buttons">
                <a href="https://www.facebook.com/sharer/sharer.php?u=<%= encodeURIComponent('http://localhost:3000/article/' + article.id) %>" 
                    target="_blank" class="social-btn facebook" title="Compartilhar no Facebook">ğŸ“˜</a>
                <a href="https://twitter.com/intent/tweet?text=<%= encodeURIComponent(article.title) %>&url=<%= encodeURIComponent('http://localhost:3000/article/' + article.id) %>" 
                    target="_blank" class="social-btn twitter" title="Compartilhar no Twitter">ğŸ¦</a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url=<%= encodeURIComponent('http://localhost:3000/article/' + article.id) %>" 
                    target="_blank" class="social-btn linkedin" title="Compartilhar no LinkedIn">ğŸ’¼</a>
                <a href="https://wa.me/?text=<%= encodeURIComponent(article.title + ' - http://localhost:3000/article/' + article.id) %>" 
                    target="_blank" class="social-btn whatsapp" title="Compartilhar no WhatsApp">ğŸ’¬</a>
                <a href="mailto:?subject=<%= encodeURIComponent(article.title) %>&body=<%= encodeURIComponent('Confira este artigo: ' + article.title + '\n\nhttp://localhost:3000/article/' + article.id) %>" 
                    class="social-btn email" title="Compartilhar por Email">ğŸ“§</a>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="article-actions">
            <div class="action-buttons">
                <a href="/home" class="btn btn-outline">
                    â† Voltar ao Blog
                </a>
                <% if (user) { %>
                    <a href="/admin/edit/<%= article.id %>" class="btn btn-primary">
                        âœï¸ Editar Artigo
                    </a>
                <% } %>
                <button onclick="window.print()" class="btn btn-outline">
                    ğŸ–¨ï¸ Imprimir
                </button>
            </div>
        </div>

        <!-- Related Articles -->
        <!-- <% if (article.relatedArticles && article.relatedArticles.length > 0) { %>
            <div class="related-articles">
                <h3>ğŸ“š Artigos relacionados</h3>
                <div class="related-grid">
                    <% article.relatedArticles.forEach(function(related) { %>
                        <a href="/article/<%= related.id %>" class="related-card">
                            <h4><%= related.title %></h4>
                            <p>
                                <%= related.summary ? 
                                    (related.summary.length > 100 ? related.summary.substring(0, 100) + '...' : related.summary) :
                                    (related.content.length > 100 ? related.content.substring(0, 100) + '...' : related.content) %>
                            </p>
                            <div class="card-meta">
                                <span>ğŸ“ <%= related.author %></span>
                                <span>ğŸ“… <%= new Date(related.createdAt).toLocaleDateString('pt-BR') %></span>
                            </div>
                        </a>
                    <% }); %>
                </div>
            </div>
        <% } %> -->

    <% } else { %>
        <!-- Error State -->
        <div class="error-container">
            <div class="error-icon">âŒ</div>
            <h1 class="error-title">Artigo nÃ£o encontrado</h1>
            <p class="error-message">
                O artigo que vocÃª estÃ¡ procurando nÃ£o existe ou foi removido.
            </p>
            <div class="action-buttons">
                <a href="/home" class="btn btn-primary">
                    ğŸ  Voltar ao Blog
                </a>
            </div>
        </div>
    <% } %>
</div>

<script>
    // Reading Progress Bar
    function updateReadingProgress() {
        const article = document.querySelector('.article-content');
        if (!article) return;

        const articleTop = article.offsetTop;
        const articleHeight = article.offsetHeight;
        const windowHeight = window.innerHeight;
        const scrollTop = window.pageYOffset;

        const progress = Math.min(
            100,
            Math.max(0, ((scrollTop - articleTop + windowHeight / 3) / articleHeight) * 100)
        );

        document.getElementById('reading-progress').style.width = progress + '%';
    }

    // Update progress on scroll
    window.addEventListener('scroll', updateReadingProgress);
    window.addEventListener('resize', updateReadingProgress);

    // Initial calculation
    updateReadingProgress();

    // Smooth scroll for internal links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Copy URL function
    function copyURL() {
        navigator.clipboard.writeText(window.location.href).then(function() {
            alert('URL copiada para a Ã¡rea de transferÃªncia!');
        }, function() {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = window.location.href;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('URL copiada para a Ã¡rea de transferÃªncia!');
        });
    }

    // Add reading time calculation for better UX
    document.addEventListener('DOMContentLoaded', function() {
        const article = document.querySelector('.article-content');
        if (article) {
            const wordCount = article.innerText.split(/\s+/).length;
            const readingTime = Math.ceil(wordCount / 200); // Average reading speed: 200 words/min
            
            // Update reading time if element exists
            const timeElement = document.querySelector('.stat-item span:contains("min de leitura")');
            if (timeElement) {
                timeElement.textContent = readingTime + ' min de leitura';
            }
        }
    });
</script>
