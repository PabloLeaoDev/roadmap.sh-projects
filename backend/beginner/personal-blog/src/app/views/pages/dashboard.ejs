<%- include('../partials/_header', {
    user: user, 
    text: {
        title: 'üìù Painel Administrativo'
    },
    headerActions: true
}) %>

<div class="main-content"
     hx-get="/admin/dashboard/partial"
     hx-trigger="load, htmx:afterPost from:body, htmx:afterDelete from:body"
     hx-target="#dashboard-content"
     hx-swap="afterbegin"
     hx-indicator="#dashboard-loader">
     
     <div id="dashboard-loader" class="htmx-indicator" style="text-align: center; padding: 2rem;">
         <div class="spinner-border" role="status">
             <span class="visually-hidden">Carregando...</span>
         </div>
     </div>
     
     <div id="dashboard-content"></div>
</div>

<div id="modal-container" class="modal-container" style="display: none;">
    <div class="modal-backdrop" onclick="closeModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-title">Modal</h3>
            <button type="button" class="btn-close" onclick="closeModal()"></button>
        </div>
        <div id="modal-body" class="modal-body"></div>
    </div>
</div>

<script>
// Fun√ß√µes para gerenciar modais
function openModal(title = '') {
    const modal = document.getElementById('modal-container');
    const modalTitle = document.getElementById('modal-title');
    modal.style.display = 'block';
    if (title) 
        modalTitle.textContent = title;
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    const modal = document.getElementById('modal-container');
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Fechar modal com ESC
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeModal();
});

// Auto-hide alerts
document.addEventListener('htmx:afterSwap', function(evt) {
    // Auto-remove alerts
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach((alert) => {
        setTimeout(() => {
            alert.style.opacity = '0';
            alert.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                alert.remove();
            }, 500);
        }, 5000);
    });

    // Re-inicializar contadores de caracteres em forms carregados via HTMX
    initCharacterCounters();
});

// Inicializar contadores de caracteres
function initCharacterCounters() {
    // Contador para t√≠tulo
    const titleInput = document.getElementById('title');
    if (titleInput && !titleInput.dataset.counterInit) {
        const titleCounter = document.createElement('div');
        titleCounter.className = 'form-text character-counter';
        titleInput.parentNode.appendChild(titleCounter);
        
        function updateTitleCounter() {
            const remaining = 200 - titleInput.value.length;
            titleCounter.textContent = `${titleInput.value.length}/200 caracteres`;
            titleCounter.style.color = remaining < 20 ? '#dc3545' : '#666';
        }
        
        titleInput.addEventListener('input', updateTitleCounter);
        titleInput.dataset.counterInit = 'true';
        updateTitleCounter();
    }

    // Contador para resumo
    const summaryInput = document.getElementById('summary');
    if (summaryInput && !summaryInput.dataset.counterInit) {
        const summaryCounter = document.createElement('div');
        summaryCounter.className = 'form-text character-counter';
        summaryInput.parentNode.appendChild(summaryCounter);
        
        function updateSummaryCounter() {
            const remaining = 500 - summaryInput.value.length;
            summaryCounter.textContent = `${summaryInput.value.length}/500 caracteres`;
            summaryCounter.style.color = remaining < 50 ? '#dc3545' : '#666';
        }
        
        summaryInput.addEventListener('input', updateSummaryCounter);
        summaryInput.dataset.counterInit = 'true';
        updateSummaryCounter();
    }
}

// Inicializar quando a p√°gina carrega
document.addEventListener('DOMContentLoaded', initCharacterCounters);
</script>

<style>
.modal-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
}

.modal-backdrop {
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
}

.modal-content {
    position: relative;
    background: white;
    margin: 2rem auto;
    max-width: 800px;
    max-height: 90vh;
    border-radius: 8px;
    overflow: hidden;
    z-index: 1001;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid #dee2e6;
}

.modal-body {
    padding: 1rem;
    overflow-y: auto;
    max-height: 70vh;
}

.htmx-indicator {
    opacity: 0;
    transition: opacity 200ms ease-in;
}

.htmx-request .htmx-indicator {
    opacity: 1;
}

.htmx-request.htmx-indicator {
    opacity: 1;
}

.character-counter {
    margin-top: 0.25rem;
    font-size: 0.875rem;
}
</style>